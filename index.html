<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container p-3">
      <form>
        <div class="mb-3">
          <label for="fullname" class="form-label">ชื่อ นามสกุล</label>
          <input
            type="text"
            class="form-control"
            id="fullname"
            placeholder="นายชื่อ นามสกุล"
            required
          />
        </div>

        <div class="mb-3">
          <label for="telephone" class="form-label">เบอร์โทร</label>
          <input
            type="tel"
            class="form-control"
            id="telephone"
            placeholder="0987654321"
            required
          />
        </div>

        <div class="mb-3">
          <label for="imageInput" class="form-label"
            >กรุณาเลือกรูปภาพที่ต้องการเซ็น</label
          >
          <input
            class="form-control"
            type="file"
            id="imageInput"
            accept="image/*"
          />
        </div>

        <div>
          <img id="imagePreview" class="img-fluid mb-3" src="#" alt="" />
        </div>

        <div id="overlay" style="position: relative">
          <div
            class="draggable bg-light p-1 border"
            contenteditable="true"
            style="position: absolute; top: 20px; left: 20px"
          >
            ชื่อ นามสกุล
          </div>
        </div>

        <div class="mb-3 border" id="signature-pad">
          <canvas id="signatureCanvas"></canvas>
        </div>

        <button id="clearButton" type="button" class="btn btn-primary">
          ล้างกระดาน
        </button>
        <button type="submit" class="btn btn-success">บันทึก</button>
      </form>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

    <script>
      var signaturePad;

      const imageInput = document.getElementById("imageInput");
      const imagePreview = document.getElementById("imagePreview");

      function setupSignaturePad() {
        var canvas = document.getElementById("signatureCanvas");
        var container = document.getElementById("signature-pad");
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        signaturePad = new SignaturePad(canvas, {
          backgroundColor: "rgb(255, 255, 255)",
          penColor: "rgb(0, 0, 0)",
        });
      }

      function clearSignaturePad() {
        signaturePad.clear();
      }

      imageInput.addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            imagePreview.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      document
        .getElementById("clearButton")
        .addEventListener("click", clearSignaturePad);

      document.querySelectorAll(".draggable").forEach((elem) => {
        elem.onmousedown = function (e) {
          const offsetX = e.clientX - elem.offsetLeft;
          const offsetY = e.clientY - elem.offsetTop;
          function moveAt(e) {
            elem.style.left = `${e.clientX - offsetX}px`;
            elem.style.top = `${e.clientY - offsetY}px`;
          }
          document.addEventListener("mousemove", moveAt);
          document.onmouseup = function () {
            document.removeEventListener("mousemove", moveAt);
            document.onmouseup = null;
          };
        };
      });

      document.addEventListener("DOMContentLoaded", function () {
        setupSignaturePad();
      });
    </script>
  </body>
</html>
